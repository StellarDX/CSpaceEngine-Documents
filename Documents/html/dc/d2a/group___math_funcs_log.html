<!-- HTML header for doxygen 1.14.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CSpaceEngine: 对数函数</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script type="text/javascript" src="../../darkmode_toggle.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CSpaceEngine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','搜索',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dc/d2a/group___math_funcs_log.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">函数</a>  </div>
  <div class="headertitle"><div class="title">对数函数<div class="ingroups"><a class="el" href="../../d9/ded/group___base.html">基本</a> &raquo; <a class="el" href="../../d4/d7d/group___math_funcs.html">数学函数</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>对数函数分为lb，ln，log三种，其中lb是以2为底的对数，ln是以e为底的对数，log是自定义底数(默认10)。它们的实现如下：（lb函数已弃用）  
<a href="#details">更多...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
函数</h2></td></tr>
<tr class="memitem:ga041d871f3d509e2d3056942ec665a934" id="r_ga041d871f3d509e2d3056942ec665a934"><td class="memItemLeft" align="right" valign="top">float64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga041d871f3d509e2d3056942ec665a934">log</a> (float64 _X, float64 _Base)</td></tr>
<tr class="memdesc:ga041d871f3d509e2d3056942ec665a934"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算对数函数  <br /></td></tr>
<tr class="separator:ga041d871f3d509e2d3056942ec665a934"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaef8731a686305d1bd6a26c533534ea66" id="r_gaef8731a686305d1bd6a26c533534ea66"><td class="memItemLeft" align="right" valign="top">float64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaef8731a686305d1bd6a26c533534ea66">lb</a> (float64 _X)</td></tr>
<tr class="memdesc:gaef8731a686305d1bd6a26c533534ea66"><td class="mdescLeft">&#160;</td><td class="mdescRight">[已废弃] 二进制对数  <br /></td></tr>
<tr class="separator:gaef8731a686305d1bd6a26c533534ea66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga83fbf51c51d6141aae0da95f0a494834" id="r_ga83fbf51c51d6141aae0da95f0a494834"><td class="memItemLeft" align="right" valign="top">float64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga83fbf51c51d6141aae0da95f0a494834">ln</a> (float64 _X)</td></tr>
<tr class="memdesc:ga83fbf51c51d6141aae0da95f0a494834"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算自然对数（ln(x)）  <br /></td></tr>
<tr class="separator:ga83fbf51c51d6141aae0da95f0a494834"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae2e04d504a13b0d27539a28caea1ed45" id="r_gae2e04d504a13b0d27539a28caea1ed45"><td class="memItemLeft" align="right" valign="top">float64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gae2e04d504a13b0d27539a28caea1ed45">log</a> (float64 _X)</td></tr>
<tr class="memdesc:gae2e04d504a13b0d27539a28caea1ed45"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算常用对数（log10(x)）  <br /></td></tr>
<tr class="separator:gae2e04d504a13b0d27539a28caea1ed45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabf76f84b861bb4dcf43c4428576cb84d" id="r_gabf76f84b861bb4dcf43c4428576cb84d"><td class="memItemLeft" align="right" valign="top">complex64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gabf76f84b861bb4dcf43c4428576cb84d">lbc</a> (complex64 _X, int64 K_OFFSET=0)</td></tr>
<tr class="memdesc:gabf76f84b861bb4dcf43c4428576cb84d"><td class="mdescLeft">&#160;</td><td class="mdescRight">[已废弃] 复数的二进制对数  <br /></td></tr>
<tr class="separator:gabf76f84b861bb4dcf43c4428576cb84d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0308547471ea01cb8042c8e5cc95985b" id="r_ga0308547471ea01cb8042c8e5cc95985b"><td class="memItemLeft" align="right" valign="top">complex64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga0308547471ea01cb8042c8e5cc95985b">lnc</a> (complex64 _X, int64 K_OFFSET=0)</td></tr>
<tr class="memdesc:ga0308547471ea01cb8042c8e5cc95985b"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算复数的自然对数（ln(z)）  <br /></td></tr>
<tr class="separator:ga0308547471ea01cb8042c8e5cc95985b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga63321702edc8150c60275bfbcda1f28b" id="r_ga63321702edc8150c60275bfbcda1f28b"><td class="memItemLeft" align="right" valign="top">complex64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga63321702edc8150c60275bfbcda1f28b">logc</a> (complex64 _X, int64 K_OFFSET=0)</td></tr>
<tr class="memdesc:ga63321702edc8150c60275bfbcda1f28b"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算复数的常用对数（log10(z)）  <br /></td></tr>
<tr class="separator:ga63321702edc8150c60275bfbcda1f28b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c8cdb0860b4306e12fa9be55b77eb66" id="r_ga3c8cdb0860b4306e12fa9be55b77eb66"><td class="memItemLeft" align="right" valign="top">complex64 __cdecl&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3c8cdb0860b4306e12fa9be55b77eb66">logc</a> (complex64 _X, complex64 _Base, int64 K_OFFSET=0)</td></tr>
<tr class="memdesc:ga3c8cdb0860b4306e12fa9be55b77eb66"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算复数的任意底数对数  <br /></td></tr>
<tr class="separator:ga3c8cdb0860b4306e12fa9be55b77eb66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga05b364520bae0c8aa3d0190b2303adeb" id="r_ga05b364520bae0c8aa3d0190b2303adeb"><td class="memTemplParams" colspan="2">template&lt;std::size_t N&gt; </td></tr>
<tr class="memitem:ga05b364520bae0c8aa3d0190b2303adeb"><td class="memTemplItemLeft" align="right" valign="top">fvec&lt; N &gt; __cdecl&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#ga05b364520bae0c8aa3d0190b2303adeb">ln</a> (fvec&lt; N &gt; _X)</td></tr>
<tr class="memdesc:ga05b364520bae0c8aa3d0190b2303adeb"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算向量各元素的自然对数  <br /></td></tr>
<tr class="separator:ga05b364520bae0c8aa3d0190b2303adeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac8b1a6d47c945a23ce44e86f6de07bac" id="r_gac8b1a6d47c945a23ce44e86f6de07bac"><td class="memTemplParams" colspan="2">template&lt;std::size_t N&gt; </td></tr>
<tr class="memitem:gac8b1a6d47c945a23ce44e86f6de07bac"><td class="memTemplItemLeft" align="right" valign="top">fvec&lt; N &gt; __cdecl&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#gac8b1a6d47c945a23ce44e86f6de07bac">log</a> (fvec&lt; N &gt; _X)</td></tr>
<tr class="memdesc:gac8b1a6d47c945a23ce44e86f6de07bac"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算向量各元素的常用对数  <br /></td></tr>
<tr class="separator:gac8b1a6d47c945a23ce44e86f6de07bac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1f20c67fbcd7d8aa008d472bf79620b4" id="r_ga1f20c67fbcd7d8aa008d472bf79620b4"><td class="memTemplParams" colspan="2">template&lt;std::size_t N&gt; </td></tr>
<tr class="memitem:ga1f20c67fbcd7d8aa008d472bf79620b4"><td class="memTemplItemLeft" align="right" valign="top">fvec&lt; N &gt; __cdecl&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#ga1f20c67fbcd7d8aa008d472bf79620b4">log</a> (fvec&lt; N &gt; _X, float64 _Base)</td></tr>
<tr class="memdesc:ga1f20c67fbcd7d8aa008d472bf79620b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算向量各元素的任意底数对数（标量底数）  <br /></td></tr>
<tr class="separator:ga1f20c67fbcd7d8aa008d472bf79620b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga73b6e6fabe775572362b3c4b825d318a" id="r_ga73b6e6fabe775572362b3c4b825d318a"><td class="memTemplParams" colspan="2">template&lt;std::size_t N&gt; </td></tr>
<tr class="memitem:ga73b6e6fabe775572362b3c4b825d318a"><td class="memTemplItemLeft" align="right" valign="top">fvec&lt; N &gt; __cdecl&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#ga73b6e6fabe775572362b3c4b825d318a">log</a> (fvec&lt; N &gt; _X, fvec&lt; N &gt; _Base)</td></tr>
<tr class="memdesc:ga73b6e6fabe775572362b3c4b825d318a"><td class="mdescLeft">&#160;</td><td class="mdescRight">计算向量各元素的任意底数对数（向量底数）  <br /></td></tr>
<tr class="separator:ga73b6e6fabe775572362b3c4b825d318a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">详细描述</h2>
<p>对数函数分为lb，ln，log三种，其中lb是以2为底的对数，ln是以e为底的对数，log是自定义底数(默认10)。它们的实现如下：（lb函数已弃用） </p>
<p><b>以下内容为AI智能解析，仅供参考</b></p>
<h3><a class="anchor" id="ln-函数实现原理分析"></a>
<code>ln</code> 函数实现原理分析</h3>
<p><code>ln(x)</code> 实现了双精度浮点数的自然对数函数 ，为 GLibC 中 Stephen L. Moshier 的算法（LGPL 许可）。以下是核心原理分析：</p>
<h3><a class="anchor" id="autotoc_md1-核心算法原理"></a>
<b>1. 核心算法原理</b></h3>
<p>算法基于以下数学分解：   </p><p class="formulaDsp">
\[
   x = 2^k \cdot z
   \]
</p>
<p> 其中：</p><ul>
<li>\(k\) 是指数（整数）</li>
<li>\(z\) 是尾数（归一化到区间 \([1.6 \cdot 2^{-1}, 1.6 \cdot 2^0] \approx [0.75, 1.5]\)）</li>
</ul>
<p>对数的计算转化为：   </p><p class="formulaDsp">
\[
   \ln(x) = k \cdot \ln(2) + \ln(z)
   \]
</p>
<p> 尾数 \(z\) 进一步分解为：   </p><p class="formulaDsp">
\[
   \ln(z) = \ln(c) + \ln\left(\frac{z}{c}\right)
   \]
</p>
<ul>
<li>\(c\) 是预计算的子区间中心值</li>
<li>\(\ln(\frac{z}{c})\) 用多项式逼近（泰勒级数）</li>
</ul>
<h3><a class="anchor" id="autotoc_md2-关键步骤"></a>
<b>2. 关键步骤</b></h3>
<h4><a class="anchor" id="autotoc_md1-范围缩减"></a>
<b>(1) 范围缩减</b></h4>
<ul>
<li><b>特殊值处理</b> ：</li>
<li><code>x = 1</code>：直接返回 <code>0</code></li>
<li><code>x &lt; 0</code> 或 <code>NaN</code>：返回 <code>NaN</code></li>
<li><code>x = +Inf</code>：返回 <code>+Inf</code></li>
<li><code>x = 0</code>：返回 <code>-Inf</code></li>
<li>次正规数：通过乘以 \(2^52\) 正规化</li>
<li><b>接近 1 的输入（<code>|x-1| &lt; 0.0625</code>）</b> ：</li>
<li>直接使用泰勒展开：   <p class="formulaDsp">
\[
       \ln(1+r) = r - \frac{r^2}{2} + \frac{r^3}{3} - \cdots \quad (r = x-1)
       \]
</p>
</li>
<li>分离高位 (<code>rhi</code>) 和低位 (<code>rlo</code>) 减少舍入误差</li>
</ul>
<h4><a class="anchor" id="autotoc_md2-查表与多项式逼近"></a>
<b>(2) 查表与多项式逼近</b></h4>
<ul>
<li><b>查表准备</b> ：</li>
<li>将 <code>z</code> 的区间分为 <code>128</code> 个子区间（查表索引 <code>i</code>）</li>
<li>预计算三项：<ul>
<li><code>invc = 1/c</code>（中心值的倒数）</li>
<li><code>logc = ln(c)</code>（中心值的对数）</li>
<li><code>chi</code> 和 <code>clo</code>（中心值 <code>c</code> 的高低双精度拆分）</li>
</ul>
</li>
<li><b>计算残差 <code>r</code></b> ： <div class="fragment"><div class="line">r = (z - chi - clo) * invc;  <span class="comment">// ≈ z/c - 1</span></div>
</div><!-- fragment --></li>
<li>通过双精度减法保证高精度</li>
<li><b>组合结果</b> ：   <p class="formulaDsp">
\[
   \ln(x) = \underbrace{k \cdot \ln(2)_\text{hi} + \log c}_\text{主项} + \underbrace{r}_\text{残差} + \underbrace{\text{poly}(r)_\text{修正}}
   \]
</p>
</li>
<li><code>ln(2)</code> 拆分为高位 (<code>ln2hi</code>) 和低位 (<code>ln2lo</code>) 减少舍入误差</li>
<li>多项式 <code>poly(r)</code> 拟合 \(\ln(1+r) - r\)：   <p class="formulaDsp">
\[
       \text{poly}(r) = r^2 \left( -\frac{1}{2} + r \left( \frac{1}{3} + r \left( -\frac{1}{4} + \cdots \right) \right) \right)
       \]
</p>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md3-误差控制"></a>
<b>3. 误差控制</b></h3>
<p><b>1. 表项优化</b> ：</p><ul>
<li>通过筛选确保 ：<ul>
<li><code>k*ln2hi + logc</code> 无舍入误差</li>
<li><code>z - chi - clo</code> 的误差 \(&lt; 2^{-66}\)</li>
<li><code>logc</code> 的误差最小化</li>
</ul>
</li>
</ul>
<p><b>2. 多项式阶数</b> ：</p><ul>
<li>主路径使用 5 阶多项式（相对误差 <code>≤ 0.52 ULP</code>）</li>
<li>接近 1 的路径使用 11 阶多项式（相对误差 \(≤ 2^{-63}\)）</li>
</ul>
<h3><a class="anchor" id="autotoc_md4-性能优化"></a>
<b>4. 性能优化</b></h3>
<ul>
<li><b>避免分支</b> ：通过位操作快速提取指数/尾数</li>
<li><b>并行计算</b> ：多项式使用 Horner 格式减少依赖</li>
<li><b>精度补偿</b> ：通过 <code>hi</code>/<code>lo</code> 双精度存储中间结果</li>
</ul>
<h3><a class="anchor" id="总结-1"></a>
总结</h3>
<p>该算法通过**范围缩减**将问题转化到小区间，结合 <b>预计算表</b> 提供高精度初始逼近，再用 <b>低阶多项式</b> 拟合残差。关键创新点在于：</p><ol type="1">
<li>精心设计的表项保证关键步骤零舍入误差</li>
<li>双精度拆分 (<code>chi</code>/<code>clo</code>, <code>hi</code>/<code>lo</code>) 抑制累积误差</li>
<li>对特殊区间（接近 1）单独优化</li>
</ol>
<p>最终在保证 <code>≤ 0.52 ULP</code> 精度的同时，实现了高效的数值计算。</p>
<hr  />
<p><b>以下内容为AI智能解析，仅供参考</b></p>
<h3><a class="anchor" id="log-函数实现原理分析"></a>
<code>log</code> 函数实现原理分析</h3>
<p><code>log(x)</code> 实现了双精度浮点数的常用对数（以10为底）函数。以下是其核心原理的解析：</p>
<h3><a class="anchor" id="autotoc_md1-特殊值处理"></a>
1. <b>特殊值处理</b></h3>
<ul>
<li><b>零</b> ：返回负无穷（<code>NEG_INF_DOUBLE</code>）。</li>
<li><b>无穷大</b> ：返回正无穷（<code>POS_INF_DOUBLE</code>）。</li>
<li><b>负数</b> ：返回 NaN（<code>BIG_NAN_DOUBLE</code>）。</li>
<li><b>1.0</b> ：直接返回 0.0。</li>
</ul>
<h3><a class="anchor" id="autotoc_md2-浮点数分解"></a>
2. <b>浮点数分解</b></h3>
<ul>
<li>使用 <code>frexp(x, &amp;e)</code> 将输入 <code>x</code> 分解为尾数（<code>x ∈ [0.5, 1.0)</code>）和指数 <code>e</code>（满足 \( x = \text{尾数} \times 2^e \)）。</li>
</ul>
<h3><a class="anchor" id="autotoc_md3-逼近策略选择"></a>
3. <b>逼近策略选择</b></h3>
<p>根据指数 <code>e</code> 的绝对值大小选择两种不同的逼近方法：</p><ul>
<li><b>当 |e| &gt; 2</b> ：使用 <b>变换法</b> （更精确）。</li>
<li><b>当 |e| &lt;= 2</b> ：使用 <b>直接多项式逼近法</b> （高效）。</li>
</ul>
<h3><a class="anchor" id="变换法e--2"></a>
<b>变换法（|e| &gt; 2)</b></h3>
<h4><a class="anchor" id="步骤-1"></a>
<b>步骤：</b></h4>
<ol type="1">
<li><b>调整尾数区间</b> ：<ul>
<li>若 x &lt; sqrt(0.5) ：<ul>
<li>指数减 1：<code>e -= 1</code>。</li>
<li>计算变换： <br  />
 \( z = x - 0.5 \), <br  />
 \( y = 0.5z + 0.5 = \frac{x + 0.5}{2} \)。</li>
</ul>
</li>
<li>否则：<ul>
<li>计算变换： <br  />
 \( z = x - 1 \), <br  />
 \( y = \frac{x + 1}{2} \)。</li>
</ul>
</li>
<li>更新： \( x = \frac{z}{y} \)（此时 \( x \) 在 \([-1, 1]\) 内）。</li>
</ul>
</li>
<li><b>有理分式逼近</b> ：<ul>
<li>计算 \( z = x^2 \)。</li>
<li>使用两个多项式计算比值：<ul>
<li>分子多项式 <code>R[6]</code>：<code>neval(z, R, 5)</code>。</li>
<li>分母多项式 <code>S[6]</code>：<code>deval(z, S, 5)</code>。</li>
</ul>
</li>
<li>结果： \( y = x \cdot \left( z \cdot \frac{\text{分子}}{\text{分母}} \right) \).</li>
</ul>
</li>
<li><b>合并结果</b> ：<ul>
<li>返回： <br  />
   <p class="formulaDsp">
\[
       \log_{10}(x) = \underbrace{(y \cdot \text{L10EB} + x \cdot \text{L10EB} + y \cdot \text{L10EA} + x \cdot \text{L10EA})}_{\text{尾数部分}} + \underbrace{(e \cdot \text{L102B} + e \cdot \text{L102A})}_{\text{指数部分}}
       \]
</p>
</li>
<li>其中：<ul>
<li>\(L10EA + L10EB ≈ \log_{10}(e)\)（自然对数转常用对数因子）。</li>
<li>\(L102A + L102B ≈ \log_{10}(2)\)（指数部分的对数）。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="直接多项式逼近法e--2"></a>
<b>直接多项式逼近法（|e| &lt;= 2)</b></h3>
<h4><a class="anchor" id="步骤-2"></a>
<b>步骤：</b></h4>
<ol type="1">
<li><b>调整尾数区间</b> ：<ul>
<li>若 \( x &lt; \sqrt{0.5} \)：<ul>
<li>指数减 1：<code>e -= 1</code>。</li>
<li>更新： \( x = 2x - 1 \)（区间平移）。</li>
</ul>
</li>
<li>否则： \( x = x - 1 \)。</li>
</ul>
</li>
<li><b>多项式逼近</b> ：<ul>
<li>计算 \( z = x^2 \)。</li>
<li>使用两个多项式计算比值：<ul>
<li>分子多项式 <code>P[13]</code>：<code>neval(x, P, 12)</code>。</li>
<li>分母多项式 <code>Q[12]</code>：<code>deval(x, Q, 11)</code>。</li>
</ul>
</li>
<li>结果： \( y = x \cdot \left( z \cdot \frac{\text{分子}}{\text{分母}} \right) \).</li>
</ul>
</li>
<li><b>泰勒展开修正</b> ：<ul>
<li>增加泰勒展开的前两项： \( y = y - 0.5 \cdot z \).</li>
</ul>
</li>
<li><b>合并结果</b> ：<ul>
<li>同变换法公式，组合尾数和指数部分。</li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="关键辅助函数"></a>
<b>关键辅助函数</b></h3>
<ul>
<li><b><code>neval</code></b> ：使用 Horner 方法计算多项式值（高效且数值稳定）。</li>
<li><b><code>deval</code></b> ：类似 <code>neval</code>，但额外加一次常数项（针对分母多项式优化）。</li>
</ul>
<h3><a class="anchor" id="常数设计"></a>
<b>常数设计</b></h3>
<ul>
<li><b><code>L102A/L102B</code></b> ：拆分 \(\log_{10}(2)\) 以减少浮点舍入误差。</li>
<li><b><code>L10EA/L10EB</code></b> ：拆分 \(\log_{10}(e)\)（其中 \(e\) 是自然常数）。</li>
</ul>
<h3><a class="anchor" id="精度保证"></a>
<b>精度保证</b></h3>
<ul>
<li>通过分段策略和有理分式逼近，实现在全定义域的高精度（相对误差约 \(10^{-34}\) 级别）。</li>
<li>多项式系数通过数值优化确定，确保在每段区间内误差最小。</li>
</ul>
<h3><a class="anchor" id="总结-2"></a>
<b>总结</b></h3>
<p>该算法通过浮点数分解、分段逼近和常数拆分，高效且高精度地实现了 \(\log_{10}(x)\)。其核心思想是：</p><ol type="1">
<li>将问题拆解为尾数对数 + 指数对数。</li>
<li>对尾数部分，根据大小选择最优逼近方法。</li>
<li>使用有理分式减少高阶多项式计算的数值误差。 </li>
</ol>
<h2 class="groupheader">函数说明</h2>
<a id="gaef8731a686305d1bd6a26c533534ea66" name="gaef8731a686305d1bd6a26c533534ea66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaef8731a686305d1bd6a26c533534ea66">&#9670;&#160;</a></span>lb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float64 __cdecl lb </td>
          <td>(</td>
          <td class="paramtype">float64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>[已废弃] 二进制对数 </p>
<dl class="deprecated"><dt><b><a class="el" href="../../da/d58/deprecated.html#_deprecated000002">弃用</a></b></dt><dd>此功能已废弃 </dd></dl>

</div>
</div>
<a id="gabf76f84b861bb4dcf43c4428576cb84d" name="gabf76f84b861bb4dcf43c4428576cb84d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabf76f84b861bb4dcf43c4428576cb84d">&#9670;&#160;</a></span>lbc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">complex64 __cdecl lbc </td>
          <td>(</td>
          <td class="paramtype">complex64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64</td>          <td class="paramname"><span class="paramname"><em>K_OFFSET</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>[已废弃] 复数的二进制对数 </p>
<dl class="deprecated"><dt><b><a class="el" href="../../da/d58/deprecated.html#_deprecated000003">弃用</a></b></dt><dd>此功能已废弃 </dd></dl>

</div>
</div>
<a id="ga83fbf51c51d6141aae0da95f0a494834" name="ga83fbf51c51d6141aae0da95f0a494834"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga83fbf51c51d6141aae0da95f0a494834">&#9670;&#160;</a></span>ln() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float64 __cdecl ln </td>
          <td>(</td>
          <td class="paramtype">float64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算自然对数（ln(x)） </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>真数值（必须大于0） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>满足 e^y = _X 的 y 值 </dd></dl>

</div>
</div>
<a id="ga05b364520bae0c8aa3d0190b2303adeb" name="ga05b364520bae0c8aa3d0190b2303adeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga05b364520bae0c8aa3d0190b2303adeb">&#9670;&#160;</a></span>ln() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;std::size_t N&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">fvec&lt; N &gt; __cdecl ln </td>
          <td>(</td>
          <td class="paramtype">fvec&lt; N &gt;</td>          <td class="paramname"><span class="paramname"><em>_X</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算向量各元素的自然对数 </p>
<dl class="tparams"><dt>模板参数</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">N</td><td>向量维度 </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>输入向量 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>各元素自然对数结果向量 </dd></dl>

</div>
</div>
<a id="ga0308547471ea01cb8042c8e5cc95985b" name="ga0308547471ea01cb8042c8e5cc95985b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0308547471ea01cb8042c8e5cc95985b">&#9670;&#160;</a></span>lnc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">complex64 __cdecl lnc </td>
          <td>(</td>
          <td class="paramtype">complex64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64</td>          <td class="paramname"><span class="paramname"><em>K_OFFSET</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算复数的自然对数（ln(z)） </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>复数真数值 </td></tr>
    <tr><td class="paramname">K_OFFSET</td><td>分支选择偏移量（默认为0） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>复数的自然对数 </dd></dl>

</div>
</div>
<a id="gae2e04d504a13b0d27539a28caea1ed45" name="gae2e04d504a13b0d27539a28caea1ed45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae2e04d504a13b0d27539a28caea1ed45">&#9670;&#160;</a></span>log() <span class="overload">[1/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float64 __cdecl log </td>
          <td>(</td>
          <td class="paramtype">float64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算常用对数（log10(x)） </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>真数值（必须大于0） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>满足 10^y = _X 的 y 值 </dd></dl>

</div>
</div>
<a id="ga041d871f3d509e2d3056942ec665a934" name="ga041d871f3d509e2d3056942ec665a934"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga041d871f3d509e2d3056942ec665a934">&#9670;&#160;</a></span>log() <span class="overload">[2/5]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float64 __cdecl log </td>
          <td>(</td>
          <td class="paramtype">float64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float64</td>          <td class="paramname"><span class="paramname"><em>_Base</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算对数函数 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>真数值（必须大于0） </td></tr>
    <tr><td class="paramname">_Base</td><td>底数（必须大于0且不等于1） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>满足 _Base^y = _X 的 y 值 </dd></dl>

</div>
</div>
<a id="gac8b1a6d47c945a23ce44e86f6de07bac" name="gac8b1a6d47c945a23ce44e86f6de07bac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac8b1a6d47c945a23ce44e86f6de07bac">&#9670;&#160;</a></span>log() <span class="overload">[3/5]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;std::size_t N&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">fvec&lt; N &gt; __cdecl log </td>
          <td>(</td>
          <td class="paramtype">fvec&lt; N &gt;</td>          <td class="paramname"><span class="paramname"><em>_X</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算向量各元素的常用对数 </p>
<dl class="tparams"><dt>模板参数</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">N</td><td>向量维度 </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>输入向量 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>各元素常用对数结果向量 </dd></dl>

</div>
</div>
<a id="ga1f20c67fbcd7d8aa008d472bf79620b4" name="ga1f20c67fbcd7d8aa008d472bf79620b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1f20c67fbcd7d8aa008d472bf79620b4">&#9670;&#160;</a></span>log() <span class="overload">[4/5]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;std::size_t N&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">fvec&lt; N &gt; __cdecl log </td>
          <td>(</td>
          <td class="paramtype">fvec&lt; N &gt;</td>          <td class="paramname"><span class="paramname"><em>_X</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float64</td>          <td class="paramname"><span class="paramname"><em>_Base</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算向量各元素的任意底数对数（标量底数） </p>
<dl class="tparams"><dt>模板参数</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">N</td><td>向量维度 </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>输入向量 </td></tr>
    <tr><td class="paramname">_Base</td><td>对数底数（标量） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>各元素对数结果向量 </dd></dl>

</div>
</div>
<a id="ga73b6e6fabe775572362b3c4b825d318a" name="ga73b6e6fabe775572362b3c4b825d318a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga73b6e6fabe775572362b3c4b825d318a">&#9670;&#160;</a></span>log() <span class="overload">[5/5]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;std::size_t N&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">fvec&lt; N &gt; __cdecl log </td>
          <td>(</td>
          <td class="paramtype">fvec&lt; N &gt;</td>          <td class="paramname"><span class="paramname"><em>_X</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fvec&lt; N &gt;</td>          <td class="paramname"><span class="paramname"><em>_Base</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算向量各元素的任意底数对数（向量底数） </p>
<dl class="tparams"><dt>模板参数</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">N</td><td>向量维度 </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>真数值向量 </td></tr>
    <tr><td class="paramname">_Base</td><td>底数向量 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>各元素对数结果向量 </dd></dl>

</div>
</div>
<a id="ga3c8cdb0860b4306e12fa9be55b77eb66" name="ga3c8cdb0860b4306e12fa9be55b77eb66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3c8cdb0860b4306e12fa9be55b77eb66">&#9670;&#160;</a></span>logc() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">complex64 __cdecl logc </td>
          <td>(</td>
          <td class="paramtype">complex64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">complex64</td>          <td class="paramname"><span class="paramname"><em>_Base</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64</td>          <td class="paramname"><span class="paramname"><em>K_OFFSET</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算复数的任意底数对数 </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>复数真数值 </td></tr>
    <tr><td class="paramname">_Base</td><td>复数底数值 </td></tr>
    <tr><td class="paramname">K_OFFSET</td><td>分支选择偏移量（默认为0） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>复数的任意底数对数 </dd></dl>

</div>
</div>
<a id="ga63321702edc8150c60275bfbcda1f28b" name="ga63321702edc8150c60275bfbcda1f28b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga63321702edc8150c60275bfbcda1f28b">&#9670;&#160;</a></span>logc() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">complex64 __cdecl logc </td>
          <td>(</td>
          <td class="paramtype">complex64</td>          <td class="paramname"><span class="paramname"><em>_X</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64</td>          <td class="paramname"><span class="paramname"><em>K_OFFSET</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>计算复数的常用对数（log10(z)） </p>
<dl class="params"><dt>参数</dt><dd>
  <table class="params">
    <tr><td class="paramname">_X</td><td>复数真数值 </td></tr>
    <tr><td class="paramname">K_OFFSET</td><td>分支选择偏移量（默认为0） </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>返回</dt><dd>复数的常用对数 </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.14.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <!-- <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li> -->
  </ul>
</div>
</body>
</html>
